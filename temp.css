def parent_student_int_test_marks(request, roll_no):
    queryset = Internal_test_mark.objects.filter(
        roll_no=roll_no
    ).order_by('-assesment_no', '-Date')

    year = request.GET.get('year')
    if year:
        start_date = datetime.strptime(f"{year}-01-01", "%Y-%m-%d").date()
        end_date = datetime.strptime(f"{year}-12-31", "%Y-%m-%d").date()

        queryset = queryset.filter(
            Date__range=(start_date, end_date)
        )

    context = {
        'roll_no': roll_no,
        'queryset': queryset
    }

    return render(request, 'class_room/internal_test_mark_by_user.html', student_detials(request, 'Internal Test Mark', context))


def mark_list(request, roll_no):
    # retrieve all the unique dates for the specified roll number
    dates = Sec_Daily_test_mark.objects.filter(
        roll_no=roll_no
    ).values('Date').annotate(max_id=Max('id')).order_by('-Date').values_list('Date', flat=True)

    # create a dictionary to hold the marks for each date
    mark_dict = {}
    for query_date in dates:
        marks = Sec_Daily_test_mark.objects.filter(
            roll_no=roll_no,
            Date=query_date
        ).values('subject', 'mark')
        total_marks = marks.aggregate(Sum('mark'))['mark__sum']
        mark_dict[query_date] = {'marks': marks, 'total_marks': total_marks}

    context = {'roll_no': roll_no, 'mark_dict': mark_dict}
    return render(request, 'class_room/mark_list.html', context)


    def view_attendees_by_roolno(request, roll_no):
    attendees = Attendees.objects.filter(roll_no=roll_no).order_by('-Date')

    attendees_list = []
    for attendee in attendees:
        attendee_dict = {
            'Date': attendee.Date,
            'subject_states': attendee.subject_states
        }
        attendees_list.append(attendee_dict)

    context = {
        'roll_no': roll_no,
        'attendees':attendees,
        'attendeesj': json.dumps(attendees_list, cls=CustomJSONEncoder),
    }
    return render(request, 'class_room/view_attendeesbyroolno.html', student_detials(request, 'View Attendence', context))
